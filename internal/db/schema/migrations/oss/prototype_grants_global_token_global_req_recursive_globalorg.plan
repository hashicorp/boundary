                                                                                               QUERY PLAN                                                                                               
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate  (cost=133.18..133.21 rows=1 width=201) (actual time=15.037..15.295 rows=30 loops=1)
   Group Key: app_token_permission_global.private_id, app_token_global.public_id
   ->  Sort  (cost=133.18..133.19 rows=1 width=201) (actual time=14.846..14.858 rows=30 loops=1)
         Sort Key: app_token_permission_global.private_id
         Sort Method: quicksort  Memory: 32kB
         ->  Nested Loop Left Join  (cost=23.95..133.17 rows=1 width=201) (actual time=1.399..14.792 rows=30 loops=1)
               Filter: ((app_token_permission_global.grant_scope = ANY ('{children,descendants}'::text[])) OR (iam_scope_org.scope_id IS NOT NULL))
               Rows Removed by Filter: 1500
               ->  Nested Loop Left Join  (cost=23.80..132.92 rows=1 width=201) (actual time=1.373..13.753 rows=1530 loops=1)
                     ->  Nested Loop  (cost=22.49..126.22 rows=1 width=169) (actual time=1.356..9.849 rows=1530 loops=1)
                           ->  Nested Loop  (cost=22.34..118.04 rows=1 width=169) (actual time=1.332..7.032 rows=1530 loops=1)
                                 ->  Hash Join  (cost=22.19..115.06 rows=16 width=169) (actual time=1.304..3.689 rows=1530 loops=1)
                                       Hash Cond: ((app_token_permission_grant.permission_id)::text = (app_token_permission_global.private_id)::text)
                                       ->  Seq Scan on app_token_permission_grant  (cost=0.00..84.15 rows=3315 width=64) (actual time=0.019..0.904 rows=4113 loops=1)
                                       ->  Hash  (cost=22.10..22.10 rows=7 width=137) (actual time=1.261..1.264 rows=1530 loops=1)
                                             Buckets: 2048 (originally 1024)  Batches: 1 (originally 1)  Memory Usage: 238kB
                                             ->  Bitmap Heap Scan on app_token_permission_global  (cost=4.33..22.10 rows=7 width=137) (actual time=0.252..0.610 rows=1530 loops=1)
                                                   Recheck Cond: ((app_token_id)::text = 'at_global_comprehensive'::text)
                                                   Heap Blocks: exact=28
                                                   ->  Bitmap Index Scan on app_token_permission_global_app_token_id_idx  (cost=0.00..4.33 rows=7 width=0) (actual time=0.225..0.226 rows=1530 loops=1)
                                                         Index Cond: ((app_token_id)::text = 'at_global_comprehensive'::text)
                                 ->  Index Scan using iam_grant_pkey on iam_grant  (cost=0.15..0.19 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=1530)
                                       Index Cond: ((canonical_grant)::text = (app_token_permission_grant.canonical_grant)::text)
                                       Filter: (resource = ANY ('{*,user,unknown}'::text[]))
                           ->  Index Only Scan using app_token_global_pkey on app_token_global  (cost=0.15..8.17 rows=1 width=32) (actual time=0.001..0.001 rows=1 loops=1530)
                                 Index Cond: (public_id = 'at_global_comprehensive'::text)
                                 Heap Fetches: 1530
                     ->  Bitmap Heap Scan on app_token_permission_global_individual_org_grant_scope org_grants  (cost=1.32..6.67 rows=3 width=64) (actual time=0.002..0.002 rows=0 loops=1530)
                           Recheck Cond: ((app_token_permission_global.private_id)::text = (permission_id)::text)
                           Heap Blocks: exact=30
                           ->  Bitmap Index Scan on app_token_permission_global_individual_org_grant_scope_pkey  (cost=0.00..1.32 rows=3 width=0) (actual time=0.001..0.001 rows=0 loops=1530)
                                 Index Cond: ((permission_id)::text = (app_token_permission_global.private_id)::text)
               ->  Index Only Scan using iam_scope_org_pkey on iam_scope_org  (cost=0.15..0.25 rows=1 width=32) (actual time=0.000..0.000 rows=0 loops=1530)
                     Index Cond: (scope_id = (org_grants.scope_id)::text)
                     Heap Fetches: 30
 Planning Time: 1.432 ms
 Execution Time: 15.707 ms
