                                                                                                                     QUERY PLAN                                                                                                                      
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate  (cost=48.95..952.39 rows=3 width=169) (actual time=5.977..5.983 rows=1 loops=1)
   Group Key: app_token_permission_global.private_id, app_token_global.public_id
   ->  Nested Loop  (cost=48.95..952.31 rows=3 width=169) (actual time=5.487..5.900 rows=1 loops=1)
         ->  Nested Loop  (cost=48.81..944.11 rows=3 width=169) (actual time=5.453..5.864 rows=1 loops=1)
               ->  Merge Left Join  (cost=39.85..39.91 rows=7 width=137) (actual time=5.343..5.737 rows=1 loops=1)
                     Merge Cond: ((app_token_permission_global.private_id)::text = (app_token_permission_global_individual_org_grant_scope.permission_id)::text)
                     Filter: ((app_token_permission_global.grant_scope <> 'individual'::text) OR ((app_token_permission_global.grant_scope = 'individual'::text) AND (app_token_permission_global_individual_org_grant_scope.scope_id IS NOT NULL)))
                     Rows Removed by Filter: 1529
                     ->  Sort  (cost=22.20..22.22 rows=7 width=105) (actual time=4.871..5.030 rows=1530 loops=1)
                           Sort Key: app_token_permission_global.private_id
                           Sort Method: quicksort  Memory: 264kB
                           ->  Bitmap Heap Scan on app_token_permission_global  (cost=4.33..22.10 rows=7 width=105) (actual time=0.299..0.951 rows=1530 loops=1)
                                 Recheck Cond: ((app_token_id)::text = 'at_global_comprehensive'::text)
                                 Heap Blocks: exact=28
                                 ->  Bitmap Index Scan on app_token_permission_global_app_token_id_idx  (cost=0.00..4.33 rows=7 width=0) (actual time=0.262..0.263 rows=1530 loops=1)
                                       Index Cond: ((app_token_id)::text = 'at_global_comprehensive'::text)
                     ->  Sort  (cost=17.65..17.66 rows=3 width=64) (actual time=0.067..0.067 rows=1 loops=1)
                           Sort Key: app_token_permission_global_individual_org_grant_scope.permission_id
                           Sort Method: quicksort  Memory: 25kB
                           ->  Seq Scan on app_token_permission_global_individual_org_grant_scope  (cost=0.00..17.62 rows=3 width=64) (actual time=0.031..0.036 rows=1 loops=1)
                                 Filter: ((scope_id)::text = 'o__________10'::text)
                                 Rows Removed by Filter: 29
               ->  Nested Loop  (cost=8.96..129.04 rows=13 width=64) (actual time=0.084..0.100 rows=1 loops=1)
                     ->  Bitmap Heap Scan on iam_grant  (cost=8.54..19.26 rows=13 width=32) (actual time=0.028..0.030 rows=3 loops=1)
                           Recheck Cond: (resource = ANY ('{*,user,unknown}'::text[]))
                           Heap Blocks: exact=1
                           ->  Bitmap Index Scan on iam_grant_resource_ix  (cost=0.00..8.54 rows=13 width=0) (actual time=0.025..0.025 rows=3 loops=1)
                                 Index Cond: (resource = ANY ('{*,user,unknown}'::text[]))
                     ->  Index Only Scan using app_token_permission_grant_pkey on app_token_permission_grant  (cost=0.41..8.43 rows=1 width=64) (actual time=0.020..0.020 rows=0 loops=3)
                           Index Cond: ((permission_id = (app_token_permission_global.private_id)::text) AND (canonical_grant = (iam_grant.canonical_grant)::text))
                           Heap Fetches: 1
         ->  Materialize  (cost=0.15..8.17 rows=1 width=32) (actual time=0.030..0.031 rows=1 loops=1)
               ->  Index Only Scan using app_token_global_pkey on app_token_global  (cost=0.15..8.17 rows=1 width=32) (actual time=0.019..0.020 rows=1 loops=1)
                     Index Cond: (public_id = 'at_global_comprehensive'::text)
                     Heap Fetches: 1
 Planning Time: 1.971 ms
 Execution Time: 6.445 ms
(37 rows)

