                                                                                                                      QUERY PLAN                                                                                                                       
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate  (cost=959.45..959.53 rows=3 width=169) (actual time=40.466..43.550 rows=1530 loops=1)
   Group Key: app_token_permission_global.private_id, app_token_global.public_id
   ->  Sort  (cost=959.45..959.45 rows=3 width=169) (actual time=40.366..40.455 rows=1530 loops=1)
         Sort Key: app_token_permission_global.private_id
         Sort Method: quicksort  Memory: 264kB
         ->  Nested Loop Left Join  (cost=13.71..959.42 rows=3 width=169) (actual time=0.388..37.536 rows=1530 loops=1)
               Filter: ((app_token_permission_global.grant_scope <> 'children'::text) OR (app_token_permission_global_individual_project_grant_scope.scope_id IS NOT NULL))
               ->  Nested Loop  (cost=13.44..934.49 rows=3 width=137) (actual time=0.355..31.901 rows=1530 loops=1)
                     ->  Index Only Scan using app_token_global_pkey on app_token_global  (cost=0.15..8.17 rows=1 width=32) (actual time=0.034..0.035 rows=1 loops=1)
                           Index Cond: (public_id = 'at_global_comprehensive'::text)
                           Heap Fetches: 1
                     ->  Nested Loop  (cost=13.29..926.30 rows=3 width=137) (actual time=0.315..31.610 rows=1530 loops=1)
                           ->  Bitmap Heap Scan on app_token_permission_global  (cost=4.33..22.10 rows=7 width=105) (actual time=0.245..0.546 rows=1530 loops=1)
                                 Recheck Cond: ((app_token_id)::text = 'at_global_comprehensive'::text)
                                 Heap Blocks: exact=28
                                 ->  Bitmap Index Scan on app_token_permission_global_app_token_id_idx  (cost=0.00..4.33 rows=7 width=0) (actual time=0.226..0.226 rows=1530 loops=1)
                                       Index Cond: ((app_token_id)::text = 'at_global_comprehensive'::text)
                           ->  Nested Loop  (cost=8.96..129.04 rows=13 width=64) (actual time=0.010..0.019 rows=1 loops=1530)
                                 ->  Bitmap Heap Scan on iam_grant  (cost=8.54..19.26 rows=13 width=32) (actual time=0.003..0.003 rows=3 loops=1530)
                                       Recheck Cond: (resource = ANY ('{*,target,unknown}'::text[]))
                                       Heap Blocks: exact=1530
                                       ->  Bitmap Index Scan on iam_grant_resource_ix  (cost=0.00..8.54 rows=13 width=0) (actual time=0.003..0.003 rows=3 loops=1530)
                                             Index Cond: (resource = ANY ('{*,target,unknown}'::text[]))
                                 ->  Index Only Scan using app_token_permission_grant_pkey on app_token_permission_grant  (cost=0.41..8.43 rows=1 width=64) (actual time=0.004..0.005 rows=0 loops=4590)
                                       Index Cond: ((permission_id = (app_token_permission_global.private_id)::text) AND (canonical_grant = (iam_grant.canonical_grant)::text))
                                       Heap Fetches: 1530
               ->  Index Only Scan using app_token_permission_global_individual_project_grant_scope_pkey on app_token_permission_global_individual_project_grant_scope  (cost=0.28..8.30 rows=1 width=64) (actual time=0.003..0.003 rows=0 loops=1530)
                     Index Cond: ((permission_id = (app_token_permission_global.private_id)::text) AND (scope_id = 'p______o10_3'::text))
                     Heap Fetches: 1
 Planning Time: 1.406 ms
 Execution Time: 43.871 ms
