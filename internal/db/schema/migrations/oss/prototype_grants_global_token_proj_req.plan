                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate  (cost=107.74..107.77 rows=1 width=169) (actual time=11.270..11.276 rows=1 loops=1)
   Group Key: filtered_permissions.private_id, filtered_permissions.create_time, filtered_permissions.grant_this_scope, filtered_permissions.grant_scope, filtered_permissions.public_id, filtered_permissions.canonical_grants
   CTE filtered_permissions
     ->  Unique  (cost=99.35..99.36 rows=1 width=137) (actual time=10.985..11.013 rows=30 loops=1)
           ->  Sort  (cost=99.35..99.35 rows=1 width=137) (actual time=10.983..10.990 rows=30 loops=1)
                 Sort Key: app_token_permission_global.private_id, app_token_permission_global.create_time, app_token_permission_global.grant_this_scope, app_token_permission_global.grant_scope, (array_agg(DISTINCT app_token_permission_grant.canonical_grant))
                 Sort Method: quicksort  Memory: 32kB
                 ->  GroupAggregate  (cost=99.31..99.34 rows=1 width=137) (actual time=10.769..10.952 rows=30 loops=1)
                       Group Key: app_token_permission_global.private_id, app_token_global.public_id
                       ->  Sort  (cost=99.31..99.32 rows=1 width=137) (actual time=10.660..10.667 rows=30 loops=1)
                             Sort Key: app_token_permission_global.private_id
                             Sort Method: quicksort  Memory: 29kB
                             ->  Nested Loop  (cost=16.33..99.30 rows=1 width=137) (actual time=0.165..10.642 rows=30 loops=1)
                                   ->  Nested Loop  (cost=16.19..91.13 rows=1 width=137) (actual time=0.149..10.580 rows=30 loops=1)
                                         ->  Nested Loop  (cost=15.91..88.66 rows=7 width=64) (actual time=0.136..2.602 rows=4091 loops=1)
                                               ->  Hash Join  (cost=15.63..36.75 rows=2 width=32) (actual time=0.092..0.119 rows=3 loops=1)
                                                     Hash Cond: (iam_grant.resource = iam_grant_resource_enm.name)
                                                     ->  Seq Scan on iam_grant  (cost=0.00..18.80 rows=880 width=64) (actual time=0.008..0.016 rows=25 loops=1)
                                                     ->  Hash  (cost=15.59..15.59 rows=3 width=32) (actual time=0.036..0.038 rows=3 loops=1)
                                                           Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                           ->  Bitmap Heap Scan on iam_grant_resource_enm  (cost=8.48..15.59 rows=3 width=32) (actual time=0.018..0.019 rows=3 loops=1)
                                                                 Recheck Cond: (name = ANY ('{*,user,unknown}'::text[]))
                                                                 Heap Blocks: exact=1
                                                                 ->  Bitmap Index Scan on iam_grant_resource_enm_pkey  (cost=0.00..8.48 rows=3 width=0) (actual time=0.013..0.013 rows=3 loops=1)
                                                                       Index Cond: (name = ANY ('{*,user,unknown}'::text[]))
                                               ->  Index Only Scan using app_token_permission_grant_pkey on app_token_permission_grant  (cost=0.28..25.79 rows=17 width=64) (actual time=0.067..0.645 rows=1364 loops=3)
                                                     Index Cond: (canonical_grant = (iam_grant.canonical_grant)::text)
                                                     Heap Fetches: 4091
                                         ->  Index Scan using app_token_permission_global_pkey on app_token_permission_global  (cost=0.28..0.35 rows=1 width=105) (actual time=0.002..0.002 rows=0 loops=4091)
                                               Index Cond: ((private_id)::text = (app_token_permission_grant.permission_id)::text)
                                               Filter: ((app_token_id)::text = 'at_global_children_per_org'::text)
                                               Rows Removed by Filter: 0
                                   ->  Index Only Scan using app_token_global_pkey on app_token_global  (cost=0.15..8.17 rows=1 width=32) (actual time=0.001..0.002 rows=1 loops=30)
                                         Index Cond: (public_id = 'at_global_children_per_org'::text)
                                         Heap Fetches: 30
   ->  Sort  (cost=8.37..8.38 rows=1 width=169) (actual time=11.260..11.261 rows=1 loops=1)
         Sort Key: filtered_permissions.private_id, filtered_permissions.create_time, filtered_permissions.grant_this_scope, filtered_permissions.grant_scope, filtered_permissions.public_id, filtered_permissions.canonical_grants
         Sort Method: quicksort  Memory: 25kB
         ->  Nested Loop Left Join  (cost=0.28..8.36 rows=1 width=169) (actual time=11.048..11.230 rows=1 loops=1)
               Filter: ((filtered_permissions.grant_scope = ANY ('{descendants,individual}'::text[])) OR (app_token_permission_global_individual_project_grant_scope.scope_id IS NOT NULL))
               Rows Removed by Filter: 29
               ->  CTE Scan on filtered_permissions  (cost=0.00..0.02 rows=1 width=137) (actual time=10.988..10.999 rows=30 loops=1)
               ->  Nested Loop  (cost=0.28..8.33 rows=1 width=64) (actual time=0.006..0.007 rows=0 loops=30)
                     Join Filter: ((app_token_permission_global_individual_project_grant_scope.permission_id)::text = (filtered_permissions_1.private_id)::text)
                     Rows Removed by Join Filter: 1
                     ->  Index Only Scan using app_token_permission_global_individual_project_grant_scope_pkey on app_token_permission_global_individual_project_grant_scope  (cost=0.28..8.30 rows=1 width=64) (actual time=0.005..0.005 rows=0 loops=30)
                           Index Cond: ((permission_id = (filtered_permissions.private_id)::text) AND (scope_id = 'p______o10_3'::text))
                           Heap Fetches: 1
                     ->  CTE Scan on filtered_permissions filtered_permissions_1  (cost=0.00..0.02 rows=1 width=32) (actual time=0.001..0.036 rows=30 loops=1)
 Planning Time: 0.992 ms
 Execution Time: 11.596 ms
(51 rows)
