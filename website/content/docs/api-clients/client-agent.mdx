---
layout: docs
page_title: Client Agent
description: |-
  Learn how the Boundary Client Agent intercepts DNS requests as the primary resolver on the system, allowing Boundary to proxy connections transparently.
---

# Boundary Client Agent

@include 'alerts/enterprise-only.mdx'

@include 'alerts/beta.mdx'

The Boundary Client Agent is Boundary's DNS daemon.
When the Boundary Client Agent runs alongside an authenticated Boundary client, the agent establishes itself as the primary resolver on the system and intercepts DNS requests.

If you enter a hostname that matches a Boundary alias that the client is authorized to establish a session to, Boundary automatically generates the session and transparently proxies the connection on your behalf.
If the Boundary Client Agent cannot find an alias, or if there are any issues with authentication, network connectivity, or latency, the Client Agent defers DNS resolution to the previously configured DNS resolvers.

The following log is an example of a new transparent session being established:

```
2024-06-03T10:44:56.337-0700 [INFO]  2783321106: found matching Boundary target: query name=ssh.boundary.dev. qtype=A target id=ttcp_dMcUB0wRKp port=22 client port=0 user id=501
2024-06-03T10:44:56.341-0700 [INFO]  2783321106: starting proxy for: target name=ssh.boundary.dev. primary listener addr=100.92.133.79:443 session expiration=2024-06-04T01:44:56Z time until=8h0m0.048895s connections left=-1
```

The following log is an example of a user connecting to a session that is already established:

```
2024-06-03T10:44:56.341-0700 [INFO]  1781785147: existing session found: query=ssh.boundary.dev.
```

## Security

When you successfully authorize a session on a Boundary controller, the response includes a list of any brokered credentials, which include the decoded secrets.
When the Boundary Client Agent receives a DNS request, Boundary creates a new session.
An OS user can only connect to an authorized session managed by the Boundary Client Agent daemon if they are the same OS user that added the Boundary auth token used for authorizing the session.

<Note>

Currently, you cannot authenticate to multiple Boundary controllers at once.
If you authenticate to a different Boundary controller, any existing sessions are terminated and any new transparent sessions would be established with the new controller.

</Note>

The Boundary Client Agent stores the credentials and some other information related to the session in memory.
The in-memory store removes the session information:

- when the session ends.
- if the auth token stored in the Boundary expires.
- if the current OS user authenticates with a different Boundary user.
- if the current OS user authenticates to a new Boundary controller.
- if the Boundary Client Agent is paused.
- if the Boundary Client Agent is terminated.

API requests are authenticated in the same way as session proxy access.
The API returns a [403 status code](/boundary/docs/api-clients/api#status-codes) if the requester did not set the token in the Boundary Client Agent that was used to create the sessions managed by the agent for that OS user.

Credential brokering is supported for transparent sessions.
A notification appears when you establish a session against a target that is configured with credential brokering.
You can retrieve the credentials later using the following command:

```shell-session
$ boundary client-agent sessions
```

### Grants

The default grants that Boundary creates for anonymous and authenticated users are sufficient to get started with the Client Agent for the public beta.
However, in a production scenario, you may want to provide the least amount of privileges necessary for users.
For a Boundary user to be able to use the Client Agent to establish a transparent session, they must:

- be able to authenticate using an auth method.
- have read permissions for their auth token.
- have permission to establish a session to one or more targets.

You can use the following grant strings to grant those permissions:

```shell-session
type=auth-method;ids=*;actions=authorize
type=target;ids=*;actions=authorize-session
type=auth-token;ids=*;actions=read:self
```

HashiCorp highly recommends that you also grant users the permission to list resolvable aliases, as the Client Agent periodically fetches a list of aliases to match incoming DNS requests against.
Without that permission, every DNS request on the system is sent to the Boundary controller, which can easily overwhelm it.
You can use the following grant string to grant the permission to list resolvable aliases:

```shell-session
type=user;ids=*;actions=list-resolvable-aliases
```

## Configuration

The default configuration included with the Boundary Client Agent upon installation will be suitable for most users. If you want to make changes to the configuration, the configuration file is located in the following directories:

MacOS

  ```shell-session

   /Library/Application Support/HashiCorp/Boundary/boundary-client-agent.hcl

   ```

Windows

  ```shell-session

   C:\Program Files\Hashicorp Boundary\boundary-client-agent.hcl

   ```

The configuration file contains the following fields:

- `alias_refresh_interval` - Specifies how often to refresh the alias cache. The default value is 1 minute.

   Example:
   ```hcl
   alias_refresh_interval=60s
   ```

- `interface_to_use` - Specifies the interface to use instead of the default.

   Example:
   ```hcl
   interface_to_use=en1
   ```
- `v4_prefix` - Specifies an alternate prefix to use for generating IPs. Currently must be between /8 and /16

   Example:
   ```hcl
   v4_prefix=1.1.1.1/8
   ```

- `log_to_stdout` - Logs to STDOUT in addition to the `boundary-client-agent.log` file.

   Example:
   ```hcl
   log_to_stdout=false
   ```

- `log_file` - Specifies where to write the Boundary Client Agent log file to.

   Example:
   ```hcl
   log_file="/Library/Application\ /Support/HashiCorp/Boundary/boundary-client-agent.log"
   ```

- `state_file` - Specifies where to write the Boundary Client Agent state file to. This is an ephemeral file which is removed on successful shutdown.

   Example:
   ```hcl
   state_file="/Library/Application\ /Support/HashiCorp/Boundary/boundary-client-agent-state.json"
   ```

- `log_level` - Specifies the verbosity of the Client Agent logs.

   Example:
   ```hcl
   log_level=DEBUG
   ```

- `dns_request_timeout` - Specifies for how long the client agent DNS request handling, including any recursion, is allowed to run before it is canceled.

   Example:
   ```hcl
   dns_request_timeout=300s
   ```

- `override_upstream_dns_servers` - Lists the DNS servers that should be used for recursing non-Boundary requests, overriding those configured on the system.

   Example:
   ```hcl
   override_upstream_dns_servers = ["8.8.8.8", "8.8.4.4"]
   ```

## Pause the Client Agent

You can temporarily disable the Boundary Client Agent by pausing it with the following command:

```shell-session
$ boundary client-agent pause
```

When the Client Agent is paused, it does not intercept any DNS requests, and you are unable to use transparent sessions.

To resume the Client Agent, use the following command:

```shell-session
$ boundary client-agent resume
```

## Monitor status and sessions

You can check the status of the Client Agent to ensure it is running.
Authenticate to Boundary, and use the following command to check the Client Agent's status:

```shell-session
$ boundary client-agent status
```

You can retrieve information about the sessions that the Client Agent is managing.
Use the following command to list any sessions currently being managed by the Client Agent, as well as any brokered credentials for those sessions:

```shell-session
$ boundary client-agent sessions
```

## Log files

The Client Agent creates a log file by default.
You can specify where to write the Boundary Client Agent log file by using the following configuration setting:

```hcl
log_file="/Library/Application\ /Support/HashiCorp/Boundary/boundary-client-agent.log"
```

You can also configure the Client Agent to log to STDOUT in addition to the `boundary-client-agent.log` file by using the following configuration setting:

```hcl
log_to_stdout=true
```

The Client Agent also creates an emphemeral state file that is removed on successful shutdown.
You can specify where to write the state file to by using the following configuration setting:

```hcl
state_file="/Library/Application\ /Support/HashiCorp/Boundary/boundary-client-agent-state.json"
```

### Change the verbosity of logs

You can increase the log verbosity.
The default is `INFO`.
You can change the setting to `DEBUG` for greater verbosity.

Complete the following steps for your operating system to change the log verbosity:

<Tabs>
<Tab heading="MacOS" group="macos">

1. As a privileged user, open the Boundary Client Agent configuration file in the editor of your choice.
By default, it is located in the following directory:

   `/Library/Application Support/HashiCorp/Boundary/boundary-client-agent.hcl`

1. Adjust the log level.
1. Save the file and reload the configuration by sending a SIGHUP signal to the process running the Client Agent with the following command:

   ```shell-session
   sudo pkill -1 boundary-client-agent
   ```

</Tab>
<Tab heading="Windows" group="windows">

1. As a privileged user, open the Boundary Client Agent configuration file in the editor of your choice.
By default, it is located in the following directory:

   `C:\Program Files\Hashicorp Boundary\boundary-client-agent.hcl`
1. Adjust the log level.
1. Save the file and restart the Client Agent with the following command:

   ```shell-session
   net stop BoundaryClientAgent
   net start BoundaryClientAgent
   ```

</Tab>
</Tabs>

## Troubleshoot DNS errors

Refer to the following sections to troubleshoot DNS issues.

### DNS does not resolve

Refer to the following steps for your operating system to file a bug report if the DNS does not resolve:

<Tabs>
<Tab heading="MacOS" group="macos">

1. Run the following command as a privileged user to stop the DNS client:

   ```shell-session
   $ sudo launchctl stop com.hashicorp.boundary.boundary-client-agent
   ```

1. View the `boundary-client-agent.log` file.
By default, it is located in the following directory:

   `/Library/Application Support/HashiCorp/Boundary/boundary-client-agent.log`

   File a bug report, and attach the `boundary-client-agent.log` file.

</Tab>
<Tab heading="Windows" group="windows">

1. Run the following command as a privileged user to stop the DNS client:

   ```shell-session
   net stop BoundaryClientAgent
   ```

1. View the `boundary-client-agent.log` file.
By default, it is located in the following directory:

   `C:\Windows\Logs\boundary-client-agent.log`

   File a bug report and attach the boundary-client-agent.log file.

</Tab>
</Tabs>

### Log file errors read "failed to listen for DNS on either IPv4 or IPv6"

   This error occurs when another application on the local machine occupies the ports that the Boundary Client Agent uses.
   The Client Agent requires access to port 53 for IPv4 and IPv6, both UDP and TCP.

   Refer to the following steps for your operating system to diagnose the error:

<Tabs>
<Tab heading="MacOS" group="macos">

Run the `lsof` program as a privileged user to find which applications are occupying a port using the following command:

   ```shell-session
   $ sudo lsof -nP | grep ":53"
   ```

   If anything is occupying port 53, you may need to terminate the application to allow the Client Agent to start.

   Applications that use the Apple Virtualization Framework are known to sometimes occupy this port under the name `_mdnsresponder`.
   If you have any virtualization software, you may need to turn it off before you use the Client Agent.

</Tab>
<Tab heading="Windows" group="windows">

As a privileged user, open the Resource Monitor and inspect the **Network** > **Listening Ports** section to find any applications that use port 53.

If anything is occupying port 53, you may need to terminate the application to allow the Client Agent to start.

</Tab>
</Tabs>

## Conflicting software

Some software is known to cause conflicts with the Boundary Client Agent.
The following sections are an incomplete list of potential conflicts and any available workarounds for issues.

### Docker Desktop (MacOS)

Docker Desktop sometimes creates a local DNS listener that prevents the Client Agent from running.
If you run Docker Desktop 4.26 or later, you must clear the `Use kernel networking for UDP` option.
Otherwise, the Client Agent refuses to start.

### Palo Alto Networking Global Protect VPN

If you are unable to establish a transparent session while using the Palo Alto Networking Global Protect VPN, you may need to explicitly specify a network interface and the upstream DNS server(s) to use.

By default, the Client Agent reads the primary network interface's DNS server configuration and uses that information to resolve domains that are not configured as aliases in Boundary.
If the VPN configuration includes custom DNS servers, this information may not be available to the Client Agent, so you must explicitly specify the DNS server(s) to use.

To configure the DNS server(s) to use, use the `override_upstream_dns_servers` configuration option:

```hcl
# The DNS servers must be specified as an IP, or an IP:Port.
# If no port is provided, port 53 is assumed.
# The order of the entries specifies the priority.
override_upstream_dns_servers = [
   "8.8.8.8",
   "8.8.4.4:53",
]
```

### MacOS

By default, the Client Agent creates IPs on the primary network interface to serve its DNS server.
When you run the Client Agent alongside the PAN-GP VPN, the primary network interface will likely be set to a `tun` type interface, which the Client Agent cannot use for its IP addresses.
You may see errors such as the following in the `boundary-client-agent.log` file or the `boundary client-agent status` command response:

```
[ERROR] macos.addIP: error adding ipv4 address: ifconfig: ioctl (SIOCAIFADDR): Destination address required
```

To work around the default `tun` interface, you must provide an explicit network interface using the `interface_to_use` configuration option. For example:

```hcl
interface_to_use=en0
```

The `interface_to_use` option allows the Client Agent to create the IPs it needs to serve the DNS server and proxy traffic.
You must restart the Client Agent for it to update its configuration with the new setting.

### Windows

On Windows, the Client Agent may be able to create the IPs that it needs on the primary network interface, but it fails to establish any transparent sessions. You may see the following message:

```
[INFO] default route change detected, restarting
```

You must explicitly specify a network interface to use other than the primary one. You can list available network interfaces using the Powershell command `Get-NetAdapter`, or the older `route print` command. You must find the index of the interface you would normally use to connect to the internet. In this example, the interface index is `11`:

```
PS C:\> Get-NetAdapter
Name                      InterfaceDescription                    ifIndex Status       MacAddress             LinkSpeed
----                      --------------------                    ------- ------       ----------             ---------
Ethernet                  Parallels VirtIO Ethernet Adapter            11 Up           00-1C-42-B3-F2-75        10 Gbps
Ethernet 2                PANGP Virtual Ethernet Adapter Secure        24 Up           02-50-41-00-00-01         2 Gbps
```

Alternatively, if you use `route print`, refer to the following example:

```
PS C:\> route print
===========================================================================
Interface List
 24...02 50 41 00 00 01 ......PANGP Virtual Ethernet Adapter Secure
 11...00 1c 42 b3 f2 75 ......Parallels VirtIO Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
````

Your configuration should look like this:

```hcl
interface_to_use=11
```

You must restart the Client Agent for it to update its configuration with the new setting.

### Cloudflare WARP client

The Cloudflare WARP client uses a local DNS server to direct traffic.
It has built-in checks to prevent it from being run alongside other software that uses the same mechanism.
This includes the Boundary Client Agent.
If you try to use the Client Agent with the Cloudflare WARP client, it may work, or you may see an error like this one:

```
Status: Unable to Connect
Error reason: DNS Proxy Failure
Error code: CF_DNS_PROXY_FAILURE
Error description: The WARP Agent must be the only process responsible for DNS resolution on the device. One or more processes are already bound to port 53: boundary-client-agent.
Learn more: https://cfl.re/CF_DNS_PROXY_FAILURE
```

You can still install both the Cloudflare WARP client and the Boundary Client Agent on the same machine.
As long as you don't run both at the same time, they should work as expected.

## Uninstall the Client Agent on Mac

If you used the Mac installer, you can run `/Library/Application Support/HashiCorp/Boundary Uninstaller.app` to uninstall Boundary.
The uninstaller removes any installed components, including the Desktop client, CLI, and the Boundary Client Agent.

## More information

Refer to the following topics for more information:

- [Aliases](/docs/concepts/aliases)
- [Transparent sessions](/docs/concepts/transparent-sessions)