---
layout: docs
page_title: Client Agent
description: |-
  Learn how the Boundary Client Agent intercepts DNS requests as the primary resolver on the client, allowing Boundary to proxy connections transparently.
---

# Boundary Client Agent

@include 'alerts/enterprise-only.mdx'

@include 'alerts/beta.mdx'

The Boundary Client Agent is Boundary's DNS daemon.
When the Boundary Client Agent is running alongside an authenticated Boundary client, the agent establishes itself as the primary resolver on the client and intercepts DNS requests.
If you enter a hostname that matches a Boundary alias that the client is authorized to establish a session to, Boundary automatically generates the session and transparently proxies the connection on your behalf.

If the Boundary Client Agent cannot find an alias, or if there are any issues with authentication, network connectivity, or latency, the Client Agent defers DNS resolution to the previously configured DNS resolvers.

The following log is an example of a new transparent session being established:

```
2024-06-03T10:44:56.337-0700 [INFO]  2783321106: found matching Boundary target: query name=ssh.boundary.dev. qtype=A target id=ttcp_dMcUB0wRKp port=22 client port=0 user id=501
2024-06-03T10:44:56.341-0700 [INFO]  2783321106: starting proxy for: target name=ssh.boundary.dev. primary listener addr=100.92.133.79:443 session expiration=2024-06-04T01:44:56Z time until=8h0m0.048895s connections left=-1
```

The following log is an exampe of a user connecting to a session that is already established:

```
2024-06-03T10:44:56.341-0700 [INFO]  1781785147: existing session found: query=ssh.boundary.dev.
```

You can view information about the Boundary Client Agent using the command `boundary client-agent status`.

## Security

When you successfully authorize a session on a Boundary controller, the response includes a list of any brokered credentials, which include the decoded secrets.
When the Boundary Client Agent receives a DNS request, Boundary creates a new session.
An OS user can only connect to an authorized session managed by the Boundary Client Agent daemon if they are the same OS user that added the Boundary auth token used for authorizing the session.

The Boundary Client Agent stores the credentials and some other informaiton related to the session in memory.
The in-memory store removes the session information:

- when the session ends
- if the auth token stored in the Boundary expires
- if the current OS user authenticates with a different Boundary user
- if the current OS user authenticates to a new Boundary controller
- if the Boundary Client Agent is terminated

API requests are authenticated in the same way as session poxy access.
The API returns a [403 status code](/boundary/docs/api-clients/api#status-codes) if the requester did not set the token in the Boundary Client Agent that was used to create the sessions managed by the agent for that OS user.

Credential brokering is supported for transparent sessions.
A notification appears when you establish a session against a target that is configured with credential brokering.
You can retrieve credentials later using the following command:

```
$ boundary client-agent sessions
```

## Conflicting software

Some software is known to cause conflicts with the Boundary Client Agent.
The following sections are an incomplete list of potential conflicts and any available workarounds for issues.

### Docker Desktop (MacOS)

Docker Desktop sometimes creates a local DNS listener that prevents the Client Agent from running.
If you run Docker Desktop 4.26 or later, you must clear the `Use kernel networking for UDP` option.
Otherwise, the Client Agent refuses to start.

### Palo Alto Networking Global Protect VPN

If you are unable to establish a transparent session while using the Palo Alto Networking Global Protect VPN, you may need to explicitly specify a network interface and the upstream DNS server(s) to use.

By default, the Client Agent reads the primary network interface's DNS server configuration and uses that information to resolve domains that are not configured as aliases in Boundary.
If the VPN configuration includes custom DNS servers, this information may not be available to the Client Agent, so you must explicitly specify the DNS server(s) to use.

To configure the DNS server(s) to use, use the `override_upstream_dns_servers` configuration option:

```hcl
# The DNS servers must be specified as an IP, or an IP:Port.
# If no port is provided, port 53 is assumed.
# The order of the entries specifies the priority.
override_upstream_dns_servers = [
   "8.8.8.8",
   "8.8.4.4:53",
]
```

### MacOS

By default, the Client Agent creates IPs on the primary network interface to serve its DNS server.
When you run the Client Agent alongside the PAN-GP VPN, the primary network interface will likely be set to a `tun` type interface, which the Client Agent cannot use for its IP addresses.
You may see errors such as the following in the `boundary-client-agent.log` file or the `boundary client-agent status` command response:

```
[ERROR] macos.addIP: error adding ipv4 address: ifconfig: ioctl (SIOCAIFADDR): Destination address required
```

To work around the default `tun` interface, you must provide an explicit network interface using the `interface_to_use` configuration option. For example:

```hcl
interface_to_use=en0
```

The `interface_to_use` option allows the Client Agent to create the IPs it needs to serve the DNS server and proxy traffic.
You must restart the Client Agent for it to update its configuration with the new setting.

### Windows

On Windows, the Client Agent may be able to create the IPs that it needs on the primary network interface, but it fails to establish any transparent sessions. You may see the following message:

```
[INFO] default route change detected, restarting
```

You must explicitly specify a network interface to use other than the primary one. You can list available network interfaces using the Powershell command `Get-NetAdapter`, or the older `route print` command. You must find the index of the interface you would normally use to connect to the internet. In this example, the interface index is `11`:

```
PS C:\> Get-NetAdapter
Name                      InterfaceDescription                    ifIndex Status       MacAddress             LinkSpeed
----                      --------------------                    ------- ------       ----------             ---------
Ethernet                  Parallels VirtIO Ethernet Adapter            11 Up           00-1C-42-B3-F2-75        10 Gbps
Ethernet 2                PANGP Virtual Ethernet Adapter Secure        24 Up           02-50-41-00-00-01         2 Gbps
```

Alternatively, if you use `route print`, refer to the following example:

```
PS C:\> route print
===========================================================================
Interface List
 24...02 50 41 00 00 01 ......PANGP Virtual Ethernet Adapter Secure
 11...00 1c 42 b3 f2 75 ......Parallels VirtIO Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================
````

Your configuration should look like this:

```hcl
interface_to_use=11
```

You must restart the Client Agent for it to update its configuration with the new setting.

### Cloudflare WARP client

The Cloudflare WARP client uses a local DNS server to direct traffic.
It has built-in checks to prevent it from being run alongside other software that uses the same mechanism.
This includes the Boundary Client Agent.
If you try to use the Client Agent with the Cloudflare WARP client, it may work, or you may see an error like this one:

```
Status: Unable to Connect
Error reason: DNS Proxy Failure
Error code: CF_DNS_PROXY_FAILURE
Error description: The WARP Agent must be the only process responsible for DNS resolution on the device. One or more processes are already bound to port 53: boundary-client-agent.
Learn more: https://cfl.re/CF_DNS_PROXY_FAILURE
```

You can still install both the Cloudflare WARP client and the Boundary Client Agent on the same machine.
As long as you don't run both at the same time, they should work as expected.

## Frequently asked questions

**Where is the configuration file for the Boundary Client Agent?**

MacOS

  ```shell-session

   /Library/Application Support/HashiCorp/Boundary/boundary-client-agent.hcl

   ```

Windows

  ```shell-session

   C:\Program Files\Hashicorp Boundary\boundary-client-agent.hcl

   ```

Fields include:

_interface_to_use:_ Used to specify interface instead of the default
```hcl
interface_to_use=en1
```

_v4_prefix:_ Specify an alternate prefix to use for generating IPs. Currently must be between /8 and /16
```hcl
v4_prefix=1.1.1.1/8
```

_recurse_only:_ Only recurse the DNS request, do not proxy sessions
```hcl
recurse_only=false
```

_log_to_stdout:_ log to STDOUT in addition to the boundary-client-agent.log file
```hcl
log_to_stdout=false
```

_log_file:_ Specify where to write the Boundary Client Agent logfile to
```hcl
log_file="/Library/Application\ /Support/HashiCorp/Boundary/boundary-client-agent.log"
```

_state_file:_ Specify where to write the Boundary Client Agent state file to. This is an ephemeral file which is removed on successful shutdown.
```hcl
state_file="/Library/Application\ /Support/HashiCorp/Boundary/boundary-client-agent-state.json"
```

_log_level:_ Specify the Verbosity of the Client Agent logs
```hcl
log_level=DEBUG
```

_dns_request_timeout:_ Duration the client will wait for a response to a DNS request
```hcl
dns_request_timeout=300s
```

_override_upstream_dns_servers:_ List of DNS servers that should be used for recursing non-Boundary request, overriding those configured on the system.
```hcl
override_upstream_dns_servers = ["8.8.8.8", "8.8.4.4"]
```